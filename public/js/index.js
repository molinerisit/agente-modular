function sid(){const k='bot_sid_v1';let v=localStorage.getItem(k);if(!v){v=Math.random().toString(36).slice(2)+Date.now().toString(36);localStorage.setItem(k,v);}return v;}async function loadMode(){const bot_id=document.getElementById('bot_id').value;const r=await fetch('/api/config?bot_id='+encodeURIComponent(bot_id));const j=await r.json();if(j.ok)document.getElementById('mode').textContent=j.config.mode;}function append(t,who){const d=document.getElementById('chat');const p=document.createElement('div');p.className='msg '+(who||'bot');p.textContent=t;d.appendChild(p);d.scrollTop=d.scrollHeight;}async function send(){const bot_id=document.getElementById('bot_id').value;const text=document.getElementById('msg').value.trim();if(!text)return;append('TÃº: '+text,'user');document.getElementById('msg').value='';const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({bot_id,message:text,session_id:sid()})});const j=await res.json();if(j.ok)append('Bot: '+j.reply,'bot');else append('Error: '+(j.error||''),'bot');}document.addEventListener('DOMContentLoaded',()=>{document.getElementById('send').addEventListener('click',send);document.getElementById('msg').addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.preventDefault();send();}});document.getElementById('bot_id').addEventListener('change',loadMode);loadMode();});